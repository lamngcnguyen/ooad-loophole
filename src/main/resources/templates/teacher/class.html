<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Courses</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/css/master.css}">
    <link rel="stylesheet" th:href="@{/css/popup.css}">
    <link rel="stylesheet" th:href="@{/css/table.css}">
    <script type="text/javascript" th:src="@{/js/libraries/jquery.min.js}"></script>
    <script type="text/javascript" th:src="@{/js/master.js}"></script>
    <!--    <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}">-->
</head>
<body>
<div class="my-container">
    <div class="my-main">
        <div class="menu-bar">
            <table style="height: 100%; width: 100%">
                <tbody>
                <tr>
                    <td style="text-align: end;">
                        <span th:text="${userFullName}" th:remove="tag"></span>
                        <img src="https://i.pinimg.com/originals/d1/1a/45/d11a452f5ce6ab534e083cdc11e8035e.png"
                             class="user-logo">
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="my-header">
            <h1>Courses</h1>
        </div>
        <div class="btn-add-class">
            <button class="btn my-btn my-btn-blue"><i class="fa fa-plus fa-fw"></i>&nbspAdd new course</button>
        </div>
        <div class="course-view">
            <table class="my-table class-table">
                <thead>
                <tr>
                    <td class="id-cell"></td>
                    <td>#</td>
                    <td>Course Name</td>
                    <td></td>
                    <td>Number of Students</td>
                    <td>Start Date</td>
                    <td>End Date</td>
                </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>
    <div class="my-sidebar">
        <div class="app-title">OOAD<br>Loophole</div>
        <div class="navigation-menu">
            <a class="navigation-item selected" href="/teacher/class"><i class="fa fa-home fa-fw"></i>&nbspCourses</a>
            <a class="navigation-item" href="#"><i class="fa fa-cog fa-fw"></i>&nbspSettings</a>
        </div>
    </div>
</div>
<div class="popup add-class-popup">
    <div class="popup-header">
        <span class="popup-close">
            <button><i class="fa fa-close"></i>&nbsp</button>
        </span>
        <span class="popup-title">New Course</span>
    </div>
    <div class="popup-body">
        <table class="form-table">
            <tbody>
            <tr>
                <td class="my-label"><label for="firstName">Course Name</label>
                </td>
                <td>
                    <input class="my-input" type="text" id="firstName">
                </td>
            </tr>
            <tr>
                <td class="my-label"><label for="startDate">Start Date</label>
                </td>
                <td><input class="my-input" type="date" id="startDate" placeholder="Start date">
                </td>
            </tr>
            <tr>
                <td class="my-label"><label for="endDate">End Date</label>
                </td>
                <td><input class="my-input" type="date" id="endDate" placeholder="End date">
                </td>
            </tr>
            <tr>
                <td>
                    <label for="dayOfWeek">Day of Week</label>
                </td>
                <td><select class="my-input" id="dayOfWeek">
                    <option value="2">Monday</option>
                    <option value="3">Tuesday</option>
                    <option value="4">Wednesday</option>
                    <option value="5">Thursday</option>
                    <option value="6">Friday</option>
                    <option value="7">Saturday</option>
                </select></td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button type="button" id="submitClass" class="my-btn my-btn-green">Create</button>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<div class="loader-container">
    <div class="loader"></div>
</div>
</body>
<script type="text/javascript">
    var classTable = $('.class-table tbody');

    $('.btn-add-class button').on('click', function () {
        showPopup('.add-class-popup');
    });

    $('.popup-close').on('click', function () {
        hidePopup('.add-class-popup');
    });

    $('#submitClass').on('click', function () {
        createNewClass();
    });

    function getMyClasses() {
        $.ajax({
            url: '/class/my-class',
            method: 'GET',
            success: function (jqXHR) {
                jqXHR.forEach(function (c, i) {
                    addClass(c, i + 1);
                })
            },
            error: function () {
                alert('oof');
            }
        })
    }

    function addClass(c, index) {
        var idCell = $('<td class="id-cell"></td>').text(c.classId);
        var numCell = $('<td></td>').text(index);
        var nameCell = $('<td class="class-ref"></td>').text(c.className).click(function () {
            window.location.href = '/teacher/class/' + c.className;
        });
        var actionCell = $('<td><i class="fa fa-ellipsis-h td-action-icon"></i>&nbsp</td>');
        var studentCell = $('<td></td>').text(c.numberOfStudents);
        var startDateCell = $('<td></td>').text(c.startDate);
        var endDateCell = $('<td></td>').text(c.endDate);

        var row = $('<tr></tr>')
            .append(idCell, numCell, nameCell, actionCell, studentCell, startDateCell, endDateCell);
        classTable.append(row);
    }

    function createNewClass() {
        showSpinner();
        var className = $('input#firstName').val();
        var startDate = $('input#startDate').val();
        var endDate = $('input#endDate').val();
        var dayOfWeek = $('select#dayOfWeek option:selected').val();

        $.ajax({
            url: '/class?name=' + className + '&startDate=' + startDate + '&endDate=' + endDate + '&dayOfWeek=' + dayOfWeek,
            method: 'post',
            success: function () {
                window.location.href = '/teacher/class/' + className;
            },
            error: function () {
                alert('Cannot create new class!');
            }
        })
    }

    $(document).ready(function () {
        getMyClasses();
    });

</script>
<style>
    .course-view {
        padding-left: 16px;
        padding-right: 16px;
    }

    .btn-add-class {
        padding-left: 16px;
        margin-bottom: 16px;
    }

    .add-class-popup {
        width: 400px;
        height: 280px;
    }

    #submitClass {
        float: right;
    }
</style>
</html>